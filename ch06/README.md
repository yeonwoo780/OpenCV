# Chapter_6

## 	영상의 특징추출

#### 에지 검출과미분

- 기본적인 에지 검출 방법

  영상을 (x, y) 변수의 함수로 간주했을 때, 이 함수의 1차 미분(1st derivative) 값이 크게 나타나는 부분을 검출

  <br>



- 소벨 필터를 이용한 미분 함수

  cv2.Sobel(src, ddepth, dx, dy, dst=None, ksize=None, scale=None,  delta=None, borderType=None)

  ​	dx : x방향 미분차수

  ​	dy : y방향 미분차수

  <br>



- 샤르 필터를 이용한 미분 함수

  cv2.Scharr(src, ddepth, dx, dy, dst=None, scale=None, delta=None,  borderType=None)

  ​	dx : x방향 미분차수

  ​	dy : y방향 미분차수

  <br>



#### 그래디언트와 에지검출

- 영상의 그래디언트(gradient)

  함수 f(x, y)를 x축과 y 축으로 각각 편미분(partial derivative)하여 벡터 형태로 표현한 것

  <br>



- 실제 영상에서 구한 그래디언트 크기와 방향

  그래디언트 크기 : 픽셀 값의 차이 정도, 변화량

  그래디언트 방향 : 픽셀 값이 가장 급격하게 증가하는 방향

  <br>



- 2D 벡터의 크기 계산 함수

  cv2.magnitude(x, y, magnitude=None)

  <br>



#### 캐니 에지검출

1. 정확한 검출 - Good detection

   픽셀이  조명에 의해 미세한 영향을 받게 되어 임계점보다 크거나 낮아짐

   이처럼 에지가 아닌 점 에지로 찾거나 에지인데 에지로 찾지 못하는 확률을 최소화 한 것을 정확한 검출이라함

   <br>

   

2. 정확한 위치 - Good localization

   실제 에지의 중심을 검출하는 것

   <br>

   

3. 단일 에지 - Single edge

   하나의 에지는 하나의 점으로 표현 한다는 것

   <br>



**케니 에지 검출 4단계**

1. 가우시안 필터링

    가우시안 필터링을 통해 잡음을 제거합니다.

    쇼벨필터에 어느정도 가우시안이 적용되어 있으므로 선택적입니다.

   <br>

   

2. 그래디언트 계산

    그래디언트 계산은 주로 소벨 마스크를 사용합니다.

    크기와 방향을 계산합니다.

    이전 포스팅에서는 크기만 계산하여 윤곽선을 추출했지만 캐니 에지 검출은 크기와 방향 모두 이용합니다.

   방향은 4구역으로 단순화 합니다.

    45도를 한 구역으로 설정하고 180도에 대한 4구역을 구합니다.

    나머지 180도는 계산된 구역의 대칭부분이므로 4구역만 이용합니다.

    4부분만 처리한다면 연산 속도는 빨라질 것입니다.

   <br>

   

3. 비최대 억제 - Non maximum suppression

   비 최대 억제는 최대 크기의 픽셀만 골라내서 에지 픽셀로 설정하는 것입니다.

    하나의 에지가 여러 개의 픽셀로 표현되는 현상을 없애기 위하여 그래디언트 크기가 국지적 최대(local maximum)인 픽셀만을 에지 픽셀로 설정합니다.

   **그래디언트 방향에 위치한 두 개의 픽셀을 조사하여 국지적 최대를 검사**합니다.

   소벨필터 임계값으로 에지를 검출할 때 5개가 검출된다면 이 중 최댓값은 1개입니다. 이 최댓값만 도출하는 것입니다.

    미분값을 좌우랑 비교해서 오른쪽, 왼쪽보다 크면 에지로 선정하고 나머지는 다 없앱니다.

    그래디언트 방향에 위치한 픽셀만을 조사합니다.

   조명이나 다른 변수에 의해 에지가 갑자기 나타날 수 있습니다. 이를 방지해줍니다.

   <br>

   

4. 히스테리시스 에지 트래킹 (Hysteresis edge tracking)

   두 개의 임계값을 사용합니다.

    조명이나 다른 변수의 영향으로 인해 영상의 그래디언트가 미세하게 변화할 수 있습니다.

    이때문에 픽셀 값이 임계점보다 커지거나 낮아질 수 있는데, 이를 방지하기 위해 두 개의 임계값을 이용합니다.

   상한 임계값, 하한 임계값 두 개를 이용합니다.

    상한 임계값보다 높으면 강한 에지가 되며 항상 에지로 선정합니다.

    상한 임계값보다 작고 하한 임계값보다 높으면 약한 에지로 부르는데 강한 에지와 연결되어 있으면 에지로 선정합니다.

    하한 임계값보다 작으면 에지가 아닙니다.

    

    조명이나 다른 변수에 의해 에지가 갑자기 나타날 수 있습니다. 이를 방지해줍니다.



- 캐니 에지 검출 함수

  cv2.Canny(image, threshold1, threshold2, edges=None, apertureSize=None,  L2gradient=None)



#### 허프 변환: 직선검출

[개념 참조 링크](https://wkdtjsgur100.github.io/Hough-Transform/)

- 허프 변환: 직선검출

  허프 변환 직선 검출은 2차원 영상 좌표에서의 직선의 방정식을 파라미터(parameter) 공간으로 변환하여 직선을 찾는 알고리즘입니다.

  직선의 방정식 y = ax + b가 있다면 b = -xa + y로 변환합니다.

  x,y 축에 있는 직선의 점을 a,b 좌표평면으로 옮기면 직선으로 표현됩니다.

  x,y 좌표평면 두 점을 a, b 좌표평면으로 옮기면 두 개의 직선으로 표현됩니다.

   이 아이디어를 이용한 것이 허프 변환입니다.

  <br>

  

- 축적 배열(accumulationarray)

  축적 배열은 직선 성분과 관련된 원소 값을 1씩 증가시키는 배열입니다.

   x,y 좌표평면에서의 직선의 한 점을 a, b 좌표평면으로 옮기면 직선으로 표현됩니다.

   이 직선이 지나가는 행렬의 값을 1씩 증가시키는 것입니다.

   이 작업을 반복하면 최종적으로 한 점에서 값이 높아지게 됩니다.

  <br>

  

- 허프 변환에 의한 선분 검출

  cv2.HoughLines(image, rho, theta, threshold, lines=None, srn=None, stn=None,  min_theta=None, max_theta=None)

  <br>

  

- 확률적 허프 변환에 의한 선분 검출(Probability)

  cv2.HoughLinesP(image, rho, theta, threshold, lines=None,  minLineLength=None, maxLineGap=None)

  minLineLength: 검출할 선분의 최소 길이

  maxLineGap: 직선으로 간주할 최대 에지 점 간격

  <br>



#### 허프 변환: 원검출

허프 변환을 응용하여 원을 검출할 수 있음

직선 검출과 같이 원의 방정식을 파라미터 좌표평면에 표현하면 3차원 축적 평면이 되므로 연산속도가 너무 오래 걸립니다.

속도를 더 빠르기 위해 제안된 방법이 Hough gradient method 입니다.



- Hough gradient method

  원에서 검출된 에지의 원주 점의 정보를 이용합니다.

  원 에지 픽셀에서 그래디언트를 계산합니다.

  그래디언트 크기 방향으로 직선을 그리면서 값을 누적시킵니다..

  그래디언트 크기는 원의 중심을 향하므로 직선은 원의 중심에서 모이게 됩니다.

  이처럼 원의 중심을 찾습니다.

  원의 중심을 찾은 후 반지름을 찾습니다.

  원의 중심에서 반지름을 점점 키워가면서 원주와 만나는지를 확인합니다. 

  단점은 여러 개의 동심원을 검출 못합니다.

  가장 작은 원 하나만 검출됩니다.

  <br>

  

- 허프 변환 원 검출 함수

  cv2.HoughCircles(image, method, dp, minDist, circles=None, param1=None,  param2=None, minRadius=None, maxRadius=None)

